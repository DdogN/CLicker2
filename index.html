<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Clickers</title>
        <style type="text/css">
            body {
                font-family: Verdana, Geneva, Tahoma, sans-serif;
                background: lightgray;
            }
            button {
                background: green;
                border: 0;
                padding: 10px;
                border-radius: 5px;
                transition: 0.2s;
                cursor: pointer;
                touch-action: manipulation;
            }
            .shop-item button {
                background: red;
            }
            .big {
                width: 200px;
                height: 200px;
                font-size: 30px;
            }
            hr {
                border: 1px solid #C8C8C8;
            }
            #shop div, #black-market div {
                margin-bottom: 5px;
            }
            #black-market {
                display: none;
            }
            #unlock-black-market {
                margin-top: 20px;
            }
        </style>
    </head>
    <body>
        <div id="game">
            <h1 id="clicks">0 clicks</h1>
            <button onclick="addClick(1);" class="big">Click to earn clicks</button>
            <p style="font-size: 20px;"><strong><span id="eps">0</span></strong> clicks per second</p>
            <h2>Shop</h2>
            <h3 id="money">$0</h3>
            <div id="shop"></div>
            <div id="black-market"><h2>Black Market</h2><p>Be careful, you could get hacked or you could be caught by the cops from purchasing on the black market.</p></div>
            <div id="unlock-black-market">
                <h2>Unlock Black Market?</h2>
                <p>Be careful, when you purchase on the black market you could get hacked or you could be caught by the cops! Don't say I didn't warn you!</p>
                <button id="unlock-button" onclick="unlockButton();">Unlock Black Market</button> <span id="black-market-price"></span>
            </div>
        </div>
        <hr>
        <div id="info">
            <div id="change-log">
                <h1>Clickers Change Log</h1>
                <ul>
                    <li><strong>1.3</strong> Introduced the black market, 5% caught, 20% hacked</li>
                    <li><strong>1.2</strong> Improved incrementing system and added "clicks per second" calculator</li>
                    <li><strong>1.1</strong> Improved release of clickers featuring 10 shop items instead of 2</li>
                    <li><a href="https://ddogn.github.io/Clickers-1.0/"><strong>1.0</strong></a> This was the first offical version of clickers, not featuring much</li>
                </ul>
            </div>
            <div id="future-games">
                <h1>Future Games</h1>
                <ul>
                    <li><strong>Clickers 1990's</strong> This is a game being developed with clickers set in the 1990s, bringing green text and floppy discs. This game will launch by early June 2019!</li>
                    <li><strong>HobberRoyal</strong> This game will be a online multiplayer web based game featuring weapons and much more! This game will launch early July 2019!</li>
                </ul>
            </div>
            <div style="margin-bottom: 5px;">
                <button onclick="yeeter();">Reset Game</button>
            </div>
            <div>
                <p style="margin: 2px;">Game programmed by <strong>Owen Hobbs</strong> and designed by <strong>Drew Novak</strong></p>
            </div>
        </div>
        <script type="text/javascript">
            var increment = 100;
            var globalEps = 0;

            var clicks = 0;
            var money = 0;

            var blackMarketPrice = 5000000;
            document.getElementById("black-market-price").innerHTML="$"+blackMarketPrice;
            var blackMarketUnlocked = false;
            function unlockButton() {
                if (money>=blackMarketPrice) {
                    removeMoney(blackMarketPrice);
                    unlock();
                }
            }
            function unlock() {
                document.getElementById("black-market").style.display="block";
                document.getElementById("unlock-black-market").style.display="none";
                blackMarketUnlocked = true;
                update();
            }

            var shopItems = [];
            var shopItemsAmount = {}; // saved
            /* ----------------------------------------- */
            // Triggered by click functions
            function addClick(amount) {
                clicks = parseFloat(parseFloat(clicks) + parseFloat(amount));
                money = parseFloat(parseFloat(money) + parseFloat(amount));
                update();
            }
            function shopItemClick(name) {
                var price = getShopItemArray(name)[1];
                if(money>=price) {
                    // Buy item
                    removeMoney(price);
                    // Check if black market item
                    var item = getShopItemArray(name);
                    var shop = item[4];
                    if(shop=="black-market") {
                        // Take a risk
                        if(risk()){
                            shopItemsAmount[name]+=1;
                        }
                    }else{
                        shopItemsAmount[name]+=1;
                    }
                }
                update();
            }
            function risk() {
                var max = 100;
                var random = Math.floor(Math.random() * Math.floor(max));
                if(random>=80) {
                    // Caught
                    update();
                    alert("You have been hacked and your purchase has been stolen!");
                    return false;
                }
                if(random<=5) {
                    // Hacked

                    // Prevent closing window from alert
                    update();
                    idoter = true;
                    localStorage.clear();

                    alert("You have been caught by the cops!");
                    yeeter();

                    return false;
                }
                return true;
            }
            /* ----------------------------------------- */
            // Constantly updated functions
            function update() {
                document.getElementById("clicks").innerHTML=parseInt(clicks)+" clicks";
                document.getElementById("money").innerHTML="$"+parseInt(money);
                display();
                save();
            }
            function display() {
                for(var i = 0; i < shopItems.length; i++) {
                    var name = shopItems[i][0];
                    var price = shopItems[i][1];
                    var ms = shopItems[i][2];
                    var earnings = shopItems[i][3];
                    var e = document.getElementById(name+"-button");
                    if(money>=price) {
                        // Display
                        e.style.background="green";
                    }else{
                        // Do not display
                        e.style.background="red";
                    }
                    document.getElementById(name+"-count").innerHTML=shopItemsAmount[name];
                }
                var button = document.getElementById("unlock-button");
                if(money>=blackMarketPrice) {
                    // Display
                    button.style.background="green";
                }else{
                    // Do not display
                    button.style.background="red";
                }
            }
            /* ----------------------------------------- */
            // Behind the scences functions
            function registerShopItem(name,price,ms,earnings, market) {
                shopItems.push([name, price,ms,earnings,market]);
                shopItemsAmount[name] = 0;
                var display = name.replace("-"," ");
                display = display.replace("-"," ");

                var html = "<div id=\""+name+"\" class=\"shop-item\"><button id=\""+name+"-button\" onclick=\"shopItemClick('"+name+"')\">"+display+"</button><span class=\"shop-item-price\">$"+price+"</span> - <span class=\"shop-item-count\" id=\""+name+"-count\">0</span></div>";

                switch(market) {
                    case "shop":
                        document.getElementById("shop").innerHTML+=html;
                        break;
                    case "black-market":
                        document.getElementById("black-market").innerHTML+=html;
                        break;
                    default:
                        document.getElementById("shop").innerHTML+=html;
                        break;
                }
                
            }
            function removeMoney(amount) {
                // Weird bug, use for loop
                for(var i = 0; i < amount; i++) {
                    money--;
                }
                update();
            }
            function getShopItemArray(name) {
                for(var i = 0; i < shopItems.length; i++) {
                    var temp = shopItems[i][0];
                    if(temp==name) {
                        return shopItems[i];
                    }
                }
                return [];
            }
            function save() {
                saveData("clicks", clicks);
                saveData("money", money);
                saveData("shopItemsAmount", JSON.stringify(shopItemsAmount));
                saveData("blackMarketUnlocked", blackMarketUnlocked);
            }
            
            function load() {
                // name, price, ms, earnings, shop
                registerShopItem("Clicker",50,1000,1,"shop");
                registerShopItem("Crate",150,1200,5,"shop");
                registerShopItem("Generator",500,500,5,"shop");
                registerShopItem("Super-Generator",5000,250,15,"shop");
                registerShopItem("Faculty",45000,500,40,"shop");
                registerShopItem("Temple",135000,100,15,"shop");
                registerShopItem("Divison",405000,50,15,"shop");

                registerShopItem("Super-Computer",1000000,10,10,"black-market");
                registerShopItem("Quantum-Computer",5000000,10,100,"black-market");
                registerShopItem("Gray-Hat-Hacker",10000000,5,1000,"black-market");
                registerShopItem("Black-Hat-Hacker",75000000,1,5000,"black-market");
                registerShopItem("Legand-Hacker",100000000,1,100000,"black-market");
                
                clicks = loadData("clicks");
                if(clicks==null) {
                    clicks = 0;
                }
                
                money = loadData("money");
                if(money==null) {
                    money = 0;
                }
                shopItemsAmount = JSON.parse(loadData("shopItemsAmount"));
                if(shopItemsAmount==null) {
                    shopItemsAmount = {};
                    for(var i = 0; i < shopItems.length; i++) {
                        var name = shopItems[i][0];
                        shopItemsAmount[name] = 0;
                    }
                    save();
                }

                blackMarketUnlocked = (loadData("blackMarketUnlocked")=='true');
                if(blackMarketUnlocked) {
                    unlock();
                }

                start();
            }
            function start() {
                var names = [];
                var cache = {};
                for(var i = 0; i < shopItems.length; i++) {
                    var name = shopItems[i][0];
                    names.push(name);
                    var earnings = shopItems[i][3];
                    var ms = shopItems[i][2];
                    var eps = getEPS(earnings, ms);
                    //console.log(name +": " + eps);
                    cache[name] = eps;
                }
                setInterval(function() {
                    for(var j = 0; j < names.length; j++) {
                        var name = names[j];
                        for(var i = 0; i < shopItemsAmount[name]; i++) {
                            var eps = cache[name];
                            addClick(eps);
                            globalEps += eps;
                        }
                    }
                    globalEps = globalEps*10;
                    document.getElementById("eps").innerHTML = parseInt(globalEps);
                    globalEps = 0;
                }, increment);
            }
            function getEPS(earnings, ms) {
                // earnings * 1000 / ms = earnings per second
                eps = earnings * increment / ms;
                return eps;
            }
            /* ----------------------------------------- */
            // Simplifying functions
            var idoter = false;
            function saveData(key, data) {
                if(!idoter)
                    localStorage.setItem(key, data);
            }
            function loadData(key) {
                return localStorage.getItem(key);
            }

            /* ----------------------------------------- */
            // Load and update data
            load();
            update();

            function yeeter() {
                idoter = true;
                localStorage.clear();
                location.reload();
            }
	    </script>
    </body>
</html>
